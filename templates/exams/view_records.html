{% extends 'base.html' %}

{% block title %}View Records - Exam Management System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="fas fa-table text-success me-2"></i>
            Examination Records
        </h2>
    </div>
</div>

<!-- Filters -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-filter me-2"></i>
                    Filter Records
                </h5>
            </div>
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <label for="course" class="form-label">Course</label>
                        <select name="course" id="course" class="form-control">
                            <option value="">All Courses</option>
                            {% for course in courses %}
                                <option value="{{ course.name }}" {% if filters.course == course.name %}selected{% endif %}>
                                    {{ course.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="unit" class="form-label">Unit</label>
                        <select name="unit" id="unit" class="form-control">
                            <option value="">All Units</option>
                            {% for unit in units %}
                                <option value="{{ unit.name }}" {% if filters.unit == unit.name %}selected{% endif %}>
                                    {{ unit.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="student" class="form-label">Student</label>
                        <input type="text" name="student" id="student" class="form-control" 
                               placeholder="Name or Reg No" value="{{ filters.student }}">
                    </div>
                    <div class="col-md-3">
                        <label for="sort" class="form-label">Sort By</label>
                        <select name="sort" id="sort" class="form-control">
                            <option value="student__name" {% if filters.sort == 'student__name' %}selected{% endif %}>Student Name</option>
                            <option value="unit__course__name" {% if filters.sort == 'unit__course__name' %}selected{% endif %}>Course</option>
                            <option value="unit__name" {% if filters.sort == 'unit__name' %}selected{% endif %}>Unit</option>
                            <option value="total_average" {% if filters.sort == 'total_average' %}selected{% endif %}>Total Average</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-search me-1"></i>Filter
                        </button>
                        <a href="{% url 'exams:view_records' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>Clear
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Records Table -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    Exam Records ({{ page_obj.paginator.count }} total)
                </h5>
                <a href="{% url 'exams:enter_marks' %}" class="btn btn-primary btn-sm">
                    <i class="fas fa-plus me-1"></i>Add New Record
                </a>
            </div>
            <div class="card-body">
                {% if page_obj %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th style="color: black;">Student Name</th>
                                    <th style="color: black;">Reg No</th>
                                    <th style="color: black;">Course</th>
                                    <th style="color: black;">Unit</th>
                                    <th style="color: black;">CAT 1</th>
                                    <th style="color: black;">CAT 2</th>
                                    <th style="color: black;">CAT Avg</th>
                                    <th style="color: black;">End Term</th>
                                    <th style="color: black;">Total Avg</th>
                                    <th style="color: black;">Grade</th>
                                    <th style="color: black;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in page_obj %}
                                <tr>
                                    <td>
                                        <strong>{{ record.student.name }}</strong>
                                    </td>
                                    <td>
                                        <code>{{ record.student.registration_number }}</code>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ record.unit.course.name }}</span>
                                    </td>
                                    <td>{{ record.unit.name }}</td>
                                    <td>
                                        <span class="badge bg-secondary">{{ record.cat1_score }}/30</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ record.cat2_score }}/30</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">{{ record.cat_average|floatformat:2 }}</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">{{ record.end_term_score }}/70</span>
                                    </td>
                                    <td>
                                        {% if record.total_average >= 80 %}
                                            <span class="badge bg-success">{{ record.total_average|floatformat:2 }}</span>
                                        {% elif record.total_average >= 70 %}
                                            <span class="badge bg-info">{{ record.total_average|floatformat:2 }}</span>
                                        {% elif record.total_average >= 50 %}
                                            <span class="badge bg-warning">{{ record.total_average|floatformat:2 }}</span>
                                        {% else %}
                                            <span class="badge bg-danger">{{ record.total_average|floatformat:2 }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if record.total_average >= 80 %}
                                            <span class="badge bg-success">A</span>
                                        {% elif record.total_average >= 70 %}
                                            <span class="badge bg-info">B</span>
                                        {% elif record.total_average >= 60 %}
                                            <span class="badge bg-warning">C</span>
                                        {% elif record.total_average >= 50 %}
                                            <span class="badge bg-secondary">D</span>
                                        {% else %}
                                            <span class="badge bg-danger">F</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'exams:update_record' record.id %}" 
                                               class="btn btn-outline-primary" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'exams:delete_record' record.id %}" 
                                               class="btn btn-outline-danger" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    {% if page_obj.has_other_pages %}
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page=1{% if filters.course %}&course={{ filters.course }}{% endif %}{% if filters.unit %}&unit={{ filters.unit }}{% endif %}{% if filters.student %}&student={{ filters.student }}{% endif %}{% if filters.sort %}&sort={{ filters.sort }}{% endif %}">
                                        <i class="fas fa-angle-double-left"></i>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if filters.course %}&course={{ filters.course }}{% endif %}{% if filters.unit %}&unit={{ filters.unit }}{% endif %}{% if filters.student %}&student={{ filters.student }}{% endif %}{% if filters.sort %}&sort={{ filters.sort }}{% endif %}">
                                        <i class="fas fa-angle-left"></i>
                                    </a>
                                </li>
                            {% endif %}
                            
                            {% for num in page_obj.paginator.page_range %}
                                {% if page_obj.number == num %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ num }}</span>
                                    </li>
                                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ num }}{% if filters.course %}&course={{ filters.course }}{% endif %}{% if filters.unit %}&unit={{ filters.unit }}{% endif %}{% if filters.student %}&student={{ filters.student }}{% endif %}{% if filters.sort %}&sort={{ filters.sort }}{% endif %}">{{ num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if filters.course %}&course={{ filters.course }}{% endif %}{% if filters.unit %}&unit={{ filters.unit }}{% endif %}{% if filters.student %}&student={{ filters.student }}{% endif %}{% if filters.sort %}&sort={{ filters.sort }}{% endif %}">
                                        <i class="fas fa-angle-right"></i>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if filters.course %}&course={{ filters.course }}{% endif %}{% if filters.unit %}&unit={{ filters.unit }}{% endif %}{% if filters.student %}&student={{ filters.student }}{% endif %}{% if filters.sort %}&sort={{ filters.sort }}{% endif %}">
                                        <i class="fas fa-angle-double-right"></i>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No exam records found</h4>
                        <p class="text-muted">Start by adding some exam records.</p>
                        <a href="{% url 'exams:enter_marks' %}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Add First Record
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 